# Openstack的网络配置



**首先在浏览器输入咱们的控制节点的ip地址登陆horizon，也就是dashboard控制页面**

**![img](assets/1092539-20170330171107492-712633582.png)**

**输入好用户名与密码，这时输入的用户名与密码会与我们的老大哥keystone进行认证。确认你输入的这个用户有没有权限登录这个云平台。然后会返回一个token给这个用户。**

 

**ok，这是登录进来的页面，有三个项目，一个是admin项目，创建的一个demo项目，还有是openstack中所有组件所在的一个service项目**

**![img](assets/1092539-20170330171239055-1350496197.png)**

 

**选择管理员选项中的网络配置，可以看到上面什么都没有**

**![img](https://images2015.cnblogs.com/blog/1092539/201703/1092539-20170330172603930-145155468.png)**

 

**点击又上角的创建网络，首先这个创建的网络是属于虚拟的，这个网络创建完成后，所有的租户都要连接到这个网络上来。就相当于一个核心交换的功能，想要vm上网就需要通过这个条网络。只有管理员才能创建共享的网络，其他用户无法创建**

**![img](assets/1092539-20170330172953789-1245001342.png)**

**各位请看**

**因为项目属于admin，所以这个网络并不属于任何一个租户。**

 

**供应商网络类型就是五种网络模式**

**![img](assets/1092539-20170330173214727-1821411801.png)**

**这里我们选择vxlan**

**段ID就是vlan的vlan ID ；GRE的Tunnel ID；Vxlan的VNI这里我们选择1**

**网络模式选择共享与外部网络，因为这个网络创建就是让各个租户来连接，并且属于访问Internet的网络。**

 

**在network网络节点控制台上面输入"ip netns show"**

**![img](assets/1092539-20170330173653305-247706460.png)**

**什么都没有，然后点击提交**

**![img](https://images2015.cnblogs.com/blog/1092539/201703/1092539-20170330173753461-113272029.png)**

 

**上面创建的网络属于admin项目中，而且登录的用户也是admin用户，所以点击下项目下的网络进行网络配置**

**![img](assets/1092539-20170330174637602-1878202759.png)**

 

**点创建子网**

**![img](assets/1092539-20170331092007258-1749361246.png)**

![img](assets/1092539-20170331092024320-800780045.png)

**网络地址：**

网络地址是网络节点唯一能上网的那个IP的网段

 **![img](assets/1092539-20170331092131430-1913293674.png)**

 

之前是ens33后来将ens33的IP添加到br-ex网桥中

 **网关：**

　　真实物理机的网关

 **分配地址池：**

　　dhcp的地址池

 

再来查看一下网络节点的ip netns

**![img](assets/1092539-20170331092515274-735583567.png)**

还是什么都没有，在浏览器端创建子网，再次查看网络节点的ip netns 

 **![img](assets/1092539-20170331100205430-1712246008.png)**

![img](assets/1092539-20170331101812617-615484985.png)

可以看到ID和上面命令行的ID是一样的。进入管理员网络界面，点击刚才新建的网络

![img](assets/1092539-20170331112905586-481492775.png)

 

 

第一个箭头是刚才我们创建的子网

第二个箭头是子网上面的一个端口

第三个箭头是端口上面连接的一个dhcp服务

在控制台看不太明显，查看命令行网络节点ovs-vsctl show 查看Bridge br-int

![img](assets/1092539-20170331110103586-780930545.png)

 

可以看到第一个箭头的Prot与控制台的端口名称一样，并且下面的tag1就是划分的vlan1，在创建的时候指定的ID号，有端口必然要连接一个设备，这个端口连接的就是DHCP服务，这么说，您可能不信，没关系，请看

在网络节点进入这个端口

![img](assets/1092539-20170331105607461-1383352743.png)

![img](assets/1092539-20170331105647789-293217680.png)

第一个就框就是这个dhcp的网卡，192.168.1.170就是这个dhcp的ip，可以在这里进行抓包等一系列操作

子网创建完后，核心的东西已经创建出来了，然后进行测试，退出admin用户登录demo用户

 

登录普通用户后，想要创建虚机，首先要创建网络。进入网络界面

 ![img](assets/1092539-20170331110609008-1789313743.png)

 

**可以直接看到一个external的网络，因为这个网络是管理员创建的共享网络。**

**普通用户要自己创建一个网络然后与共享网络关联，建立转发关系**

创建网络

![img](assets/1092539-20170331110758367-721589380.png)

租户自己创建的网络没有必要创建成共享的。

![img](assets/1092539-20170331110905586-313482246.png)

这个网络地址可以随便写，因为创建的是私网地址。指定网关

![img](assets/1092539-20170331111022774-64670126.png)

创建dhcp地址池，指定dns。创建

![img](assets/1092539-20170331111213242-455961882.png)

![img](assets/1092539-20170331111356086-1964986670.png)

 

ok创建成功，也可以通过命令行查看

 ![img](assets/1092539-20170331111245383-1826864898.png)

发现又新建一个dhcp，这个59b就是demo的dhcp了。登录管理员用户查看普通用户的dhcp端口

![img](assets/1092539-20170331111717117-560316154.png)

![img](assets/1092539-20170331112507555-431545567.png)

 

切回普通用户 ，想要内网访问外网，就需要将用户自己创建的网络与管理员创建的网络进行关联，所以就需要路由

![img](assets/1092539-20170331113223336-1092168123.png)

 

 创建路由![img](assets/1092539-20170331113408570-951141716.png)

![img](assets/1092539-20170331113446602-211387952.png)

这里的外部网络就是指路由器的网关，路由器要先连外在连内。创建

![img](assets/1092539-20170331113656961-1830086792.png)

![img](assets/1092539-20170331113807945-1555392162.png)

 

**注意：每创建一个网络设备都会在网络节点上出现一个名称空间**

![img](assets/1092539-20170331113734914-444113609.png)

 

创建成功后，需要将路由连接内网，这时候我们进入到网络拓扑界面

 **![img](assets/1092539-20170331113943914-1527109285.png)**

这是我们刚刚新建的路由器，点击添加接口，连接内网

 ![img](assets/1092539-20170331114037930-1452830102.png)

选择我们刚才创建的内部网络，其他的什么都不用选择了，提交

ok，发现他们三个连接上来了

![img](assets/1092539-20170331114716664-1344402107.png)

在网络节点上查看

![img](assets/1092539-20170331114848524-1763800976.png)

![img](assets/1092539-20170331115638992-1456796352.png)

一个是外网IP一个是内网IP，起到承上启下左右，在路由中ping www.baidu.com

![img](assets/1092539-20170331115757383-1873749858.png)

 

**网络有了之后就可以搭建vm了**

进入计算——云主机界面

![img](assets/1092539-20170401141359227-1509770531.png)

 

 ![img](assets/1092539-20170401141425680-1620256217.png)

**虚拟机名字**

**选择的区域（后面会说）**

 

![img](assets/1092539-20170401141435805-1266778042.png)

**选择镜像**

 

![img](assets/1092539-20170401141444492-1669207164.png)

**选择套餐，内存，cpu之类的**

 

![img](assets/1092539-20170401141455461-852632469.png)

**选择网络，这里我们选择用户自己创建的网络。****启动实例**

 

刚刚我已经创建了一个VM1所以就不在创建了

 ![img](assets/1092539-20170401142028289-830366952.png)

**详细信息**

 ![img](assets/1092539-20170401142046742-571063641.png)

 

**vnc连接，跟阿里的没啥区别**

 

还有一系列的虚拟机操作

![img](assets/1092539-20170401142141633-2133560108.png)