# 常见文件系统的格式

写这篇博客的原因是，今天买了一块移动硬盘（NTFS格式的），然后发现，在Mac OS X下，硬盘里的文件是只读的，不能像里面写入数据，于是就整理了一下几种不同文件系统的区别。

> 本文的大部分内容来源于*维基百科*，由笔者进行整理，由于知识水平有限，有些理解可能有偏差，具体以原文为准（文中已标记了出处），本文内容仅供参考

## 文件系统的概念

[wikipedia文件系统](https://en.wikipedia.org/wiki/File_system)

  文件系统（File System）是文件管理系统的简称，根据维基百科的描述，文件系统是用来组织数据在存储介质上的存储方式以及检索方式的。没有文件系统，信息在存储介质上会是一个很大的信息块，没法知道一条信息什么时候会结束，也没法知道信息在什么时候开始，对信息的管理就会十分的麻烦。

  文件系统的种类有很多，每一种文件系统的结构，逻辑，存取速度，灵活性，安全性，大小，等等都不一样。

  文件系统可以被使用在很多不同的存储设备（storage devices）上，这些存储设备使用不同的媒介（media），比如磁带，移动硬盘，闪存等，有时候，计算机的主存（RAM）甚至会创建一个临时的文件系统来临时使用。

  总之，文件系统的类别有很多，也很复杂，又想弄明白文件系统的原理，需要学习的东西有很多，这里只介绍一些平时在使用不同的操作系统时可能用到的一些知识，几种不同系统下的常见文件系统格式。

## 常见文件系统的格式

### windows系统常见的文件系统

1. FAT

    [wikipedia FAT文件系统](https://en.wikipedia.org/wiki/File_Allocation_Table#FAT16)

      FAT(File Allocation Table)文件系统诞生于1977年，它最初是为软盘设计的文件系统，但是后来随着微软推出dos和win 9x系统，FAT文件系统经过适配被逐渐用到了硬盘上，并且在那时的20年中，一直是主流的文件系统。

      后来随着硬件技术的进步，硬盘的容量也越来越大，这种文件格式逐渐被扩展了，出现了FAT12，FAT16，FAT32等文件系统，甚至后来还出现了FAT64的文件系统。

      在今天，FAT已经不是windows系统的主流文件系统了，但是它在软盘，闪存（u盘），以及很多嵌入式设备上还是很常见的。

      详细的情况wikipedia上有几张表，相关信息都可查看到。
      目前最通用的的是FAT32，很多U盘上都是FAT32格式，关于FAT32文件系统，以下几点值得注意：

    - 单个文件最大为4G
    - 最大文件数量268,435,437
    - 分区最大容量8TB
    - 可在多种操作系统读写

    有时候，我们向U盘拷贝大文件时，会发现拷不进去，实际上就是因为这个U盘是FAT32格式的。

2. NTFS

      NTFS全称是New Technology File System，它是一种比FAT32功能更加强大的文件系统。
      从windows 2000之后的windows系统的默认文件系统都是NTFS，而且这些windows系统只能够安装在NTFS格式的磁盘上。
    NTFS具有以下特点：

    - 理论上最大文件尺寸可达16EB-1KB，实际上有16TB-64KB(1EB = 1024PB 1PB = 1024TB，至于理论和实际为什么差这么多，没有进行过深入研究，有可能是现在的科技还不足以制造出这么大的磁盘的)
    - 最大文件数量可达232-1个
    - 操作系统支持大部分windows系统，Unix／Linux系统，Mac OS（在Mac OS 10.4+系统上，NTFS格式是只读的，即在Mac系统下，你只能从NTFS格式的磁盘上读取数据，而不能写入数据）
    - NTFS系统是一个日志性的文件系统，系统中对文件的操作都可以被记录下来，当系统崩溃之后，利用日志功能可以修复数据

  由于在Mac系统下，ntfs是只读的，所以要想在Mac下想ntfs格式的硬盘写入数据，要装一个插件Paragon NTFS，但据说不是太稳定。

3. ExtFAT

   ExFAT(Extended File Allocation Table)又叫FAT64，看名字就知道它是对FAT文件系统的扩展。
  E下FAT是虽然也是微软开发的文件系统，但说它是windows下的文件系统并不合适，它是专门为闪存盘设计的文件系统，单个文件突破了4G的限制，而且分区的最大容量可达64ZB（比EB大一级的），建议512TB。
  ExFAT在windows，Linux以及Mac系统上，都可以读写，作为U盘或者是移动硬盘的格式还是比较合适的。

### Mac OS系统常见的文件系统

1. HFS/HFS+
      HFS全称叫分层文件系统（Hierarchical File System，HFS），诞生于1985年，最初被设计用于软盘和硬盘，同时也可以在在只读媒体如CD-ROM上见到。
      HFS+是一个HFS的改进版本，支持更大的文件，并用Unicode来命名文件或文件夹，代替了Mac OS Roman或其他一些字符集。
      HFS+的最大文件尺寸可以达到8EB，文件数量可以达到232 - 1个。
       由于这两种文件格式是苹果专有的文件系统，所以在windows系统下，是看不到HFS分区的。

### Linux系统常见的文件系统

   这几种文件系统wikipedia上资料也不多，所以就直接拷过来了。

1. Ext2
      wikipedia英文：https://en.wikipedia.org/wiki/Ext2
      wikipedia中文：https://zh.wikipedia.org/wiki/Ext2

    >   第二代扩展文件系统（英语：second extended filesystem，缩写为 ext2），是LINUX内核所用的文件系统。它开始由RémyCard设计，用以代替ext，于1993年1月加入linux核心支持之中。ext2的经典实现为LINUX内核中的ext2fs文件系统驱动，最大可支持2TB的文件系统，至linux核心2.6版时，扩展到可支持32TB。其他的实现包括GNU Hurd，Mac OS X (第3方)，Darwin(第3方)，BSD。
    >   ext2为数个LINUX发行版的默认文件系统，如Debian、Red Hat > Linux等。

2. Ext3
      wikipedia英文：https://en.wikipedia.org/wiki/Ext3
      wikipedia中文：https://zh.wikipedia.org/wiki/Ext3

    >   第三代扩展文件系统（英语：Third extended filesystem，缩写为ext3），是一个日志文件系统，常用于Linux操作系统。它是很多Linux发行版的默认文件系统。Stephen Tweedie在1999年2月的内核邮件列表[2]中，最早显示了他使用扩展的ext2，该文件系统从2.4.15版本的内核开始，合并到内核主线中[3]。
    >   它的性能（速度）不如它的竞争对手，例如JFS2，ReiserFS和XFS，但它具有重要的优势，那就是它允许在适当的时候从流行的ext2文件系统升级，而无需备份和恢复数据；除此之外，它还具有比ReiserFS和XFS更低的的CPU使用率。
    >   尽管Ext3相对于Ext2有了不少的优势，但是它还是有一些劣势：
    > （1）ext3会在删除文件时把文件的节点（inode）中的块指标清除。这样做可以在unclean载入文件系统后，重放日志时，可以减少对文件系统的访问。但也同样也增加了文件在反删除上面的困难。用户唯一的补救是在硬盘中捞取数据，并且要知道文件的起始到结束的块指标。尽管提供了比 ext2在删除文件上稍微高一些的安全性，却也无可避免的带来了不便之处。
    > （2）Ext3不支持透明压缩（Ext2以非官方补丁支持）。
    > （3）大小限制，见下表。
    >
    > | 块尺寸 | 最大文件尺寸 | 最大文件系统尺寸 |
    > | ------ | ------------ | ---------------- |
    > | 1KB    | 16GB         | 2TB              |
    > | 2KB    | 256GB        | 8TB              |
    > | 4KB    | 2GB          | 16TB             |
    > | 8KB    | 16GB         | 32TB             |
    >
    > （4）Ext3在写入日志时，并不做校验和。如果barrier=1没有作为加载参数（在文件/etc/fstab），并且如果硬件在无次序的写入缓存，在崩溃时会严重损坏文件系统（该选项在大多数流行的Linux发行版中都没有被启用，所以大多数发行版的处境都很危险。）

3 . Ext4
  wikipedia英文：https://en.wikipedia.org/wiki/Ext4
  wikipedia中文：https://zh.wikipedia.org/wiki/Ext4
Ext4具有以下特点

> - 大型文件系统
>       ext4文件系统可支持最高1 Exbibyte的分区[6]与最大16 Tebibyte的文件。
> - Extents
>       ext4引进了Extent文件存储方式，以替换ext2/3使用的block mapping方式。Extent指的是一连串的连续实体block，这种方式可以增加大型文件的效率并减少分裂文件。ext4支持的单一Extent，在单一block为4KB的系统中最高可达128MB[1]。单一inode中可存储4笔Extent；超过四笔的Extent会以Htree方式被索引。
> - 向下兼容
>       ext4向下兼容于ext3与ext2，因此可以将ext3和ext2的文件系统挂载为ext4分区。由于某些ext4的新功能可以直接运用在ext3和ext2上，直接挂载即可提升少许性能。
>     ext3文件系统可以部分向上兼容于ext4（也就是说ext4文件系统可以被挂载为ext3分区）。然而若是使用到Extent技术的ext4将无法被挂载为ext3。
> - 预留空间
>       ext4允许对一文件预先保留磁盘空间。目前大多数文件系统做到这点的方式是直接产生一个填满0的文件；ext4和XFS可以使用Linux核心中的一个新的系统调用“fallocate()”获取足够的预留空间。
> - 延迟获取空间
>       ext4使用一种称为allocate-on-flush的方式，可以在数据将被写入磁盘（sync）前才开始获取空间；大多数文件系统会在之前便获取需要的空间。这种方式可以增加性能并减少文件分散程度。
> - 突破32000子目录限制
>       ext3的一个目录下最多只能有32000个子目录。ext4的子目录最高可达64000，且使用“dir_nlink”功能后可以达到更高（虽然父目录的link count会停止增加）。为了避免性能受到大量目录的影响，ext4默认打开Htree（一种特殊的B树）索引功能。该功能已经实现于Linux核心2.6.23版。
> - 日志校验和
>       Ext4使用校验和特性来提高文件系统可靠性，因为日志是磁盘上被读取最频繁的部分之一。这个特性还有一个好处就是可以安全地避免日志处理时磁盘I/O的等待，而稍微提高一些性能。日志校验和的技术源于威斯康辛大学的一篇名为IRON File Systems的研究论文（见第六节 transaction checksums校验和处理）[7]
> - 在线磁盘整理
>       对于在线磁盘整理工具有许多草案，但是这些草案都没有被包含在主流的内核当中。即使Ext4包含有许多避免磁盘碎片的技术，但是磁盘碎片还是难免会在一个长时间使用过的文件系统中存在。Ext4将会有一个具有磁盘整理功能的工具[8]。
> - 快速文件系统检查
>       Ext4将未使用的区块标记在inode当中，这样可以使诸如e2fsck之类的工具在磁盘检查时将这些区块完全跳过，而节约大量的文件系统检查的时间。这个特性已经在2.6.24版本的Linux内核中实现。

# 文件系统格式各有哪些优点和缺点？

1、什么是NTFS－新(N)技术(T)文件(F)系统(S)？

想要了解NTFS，我们首先应该认识一下FAT。FAT(File Allocation Table)是"文件分配表"的意思。对我们来说，它的意义在于对硬盘分区的管理。FAT16、FAT32、NTFS是目前最常见的三种文件系统。

FAT16：我们以前用的DOS、Windows 95都使用FAT16文件系统，现在常用的Windows 98/2000/XP等系统均支持FAT16文件系统。它最大可以管理大到2GB的分区，但每个分区最多只能有65525个簇(簇是磁盘空间的配置单位)。随着硬盘或分区容量的增大，每个簇所占的空间将越来越大，从而导致硬盘空间的浪费。

FAT32：随着大容量硬盘的出现，从Windows 98开始，FAT32开始流行。它是FAT16的增强版本，可以支持大到2TB(2048G的分区。FAT32使用的簇比FAT16小，从而有效地节约了硬盘空间。

NTFS：微软Windows NT内核的系列操作系统支持的、一个特别为网络和磁盘配额、文件加密等管理安全特性设计的磁盘格式。随着以NT为内核的Windows 2000/XP的普及，很多个人用户开始用到了NTFS。NTFS也是以簇为单位来存储数据文件，但NTFS中簇的大小并不依赖于磁盘或分区的大小。簇尺寸的缩小不但降低了磁盘空间的浪费，还减少了产生磁盘碎片的可能。NTFS支持文件加密管理功能，可为用户提供更高层次的安全保证。

2、什么系统可以支持NTFS文件系统？

只有Windows NT/2000/XP才能识别NTFS系统，Windows 9x/Me以及DOS等操作系统都不能支持、识别NTFS格式的磁盘。由于DOS系统不支持NTFS系统，所以最好不要将C:盘制作为NTFS系统，这样在系统崩溃后便于在DOS系统下修复。

NTFS与操作系统支持情况如下：

FAT16 windows 95/98/me/nt/2000/xp unix，linux，dos

FAT32 windows 95/98/me/2000/xp

NTFS windows nt/2000/xp

3、我们需要NTFS吗？

Windows 2000/XP在文件系统上是向下兼容的，它可以很好地支持FAT16/FAT32和NTFS，其中NTFS是Windows NT/2000/XP专用格式，它能更充分有效地利用磁盘空间、支持文件级压缩、具备更好的文件安全性。如果你只安装Windows 2000/XP，建议选择NTFS文件系统。如果多重引导系统，则系统盘(C盘)必须为FAT16或FAT32，否则不支持多重引导。当然，其他分区的文件系统可以为NTFS。
1、fat16
对电脑老"鸟"而言，对这种硬盘分区格式是最熟悉不过了，我们大都是通过这种分区格式认识和踏入电脑门槛的。它采用16位的文件分配表，能支持的最大分区为2gb，是目前应用最为广泛和获得操作系统支持最多的一种磁盘分区格式，几乎所有的操作系统都支持这一种格式，从dos、win 3.x、win 95、win 97到win 98、windows nt、win 2000/XP，甚至火爆一时的linux都支持这种分区格式。
但是fat16分区格式有一个最大的缺点，那就是硬盘的实际利用效率低。因为在dos和windows系统中，磁盘文件的分配是以簇为单位的，一个簇只分配给一个文件使用，不管这个文件占用整个簇容量的多少。而且每簇的大小由硬盘分区的大小来决定，分区越大，簇就越大。例如1gb的硬盘若只分一个区，那么簇的大小是32kb，也就是说，即使一个文件只有1字节长，存储时也要占32kb的硬盘空间，剩余的空间便全部闲置在那里，这样就导致了磁盘空间的极大浪费。fat16支持的分区越大，磁盘上每个簇的容量也越大，造成的浪费也越大。所以随着当前主流硬盘的容量越来越大，这种缺点变得越来越突出。为了克服fat16的这个弱点，微软公司在win 97操作系统中推出了一种全新的磁盘分区格式fat32。

FAT即文件分配表，也即人们常说的FAT16。它是自DOS、Windows 3.x以来广泛使用的硬盘分区格式，是传统的16位文件系统。它有极好的兼容性，DOS、Windows 、Windows NT的各种版本，以及其他各类操作系统都支持FAT16。它相对速度快， CPU资源耗用少，所以至今仍是各类机器硬盘常用的分区格式。但是传统FAT16的不支持长文件名，受到8＋3，即8个字符的文件名加3个字符扩展名的限制。单个分区的最大尺寸为2GB，单个硬盘的最大容量一般不能超过8GB，所以如果硬盘容量超过8GB，8GB以上空间则因无法利用而浪费。当分区尺寸为2GB时，单"簇"（磁盘容量最小单位）尺寸为16KB，当文件数量巨大时会白白遗留许多无法利用的空间。在Windows NT中采用FAT格式，不能恢复已被删除的文件。此外，这种文件系统因其兼容性好，来者不拒，就导致安全性差，易受病毒攻击。

自Windows 95起微软推出扩展文件分配表VFAT，它突破了8＋3的限制，支持长文件名，最长可达255个字符，包括后缀，并且文件名中可包含多个空格或多个后缀，其它优缺点基本同FAT16。

2、fat32

FAT32是Windows 95 OSR2版开始推出兼容16位的32位文件系统。最大特点为使用较小的簇（每簇仅为4KB）分配文件单元，大大提高硬盘空间利用率，减少了浪费。单个硬盘的最大容量达到2TB（1TB=1024GB），为海量硬盘的使用者提供了方便。它支持长文件名，能很好运行 DOS、Windows 95－2000的各种版本，但系统开销要大于FAT16。这种文件系统的安全性仍然较差；FAT32可以兼容FAT16，但无法访问NTFS分区。对于像Word一类的编辑软件产生的文本文件而言，在FAT32的机器上建立的文件只有以"纯文本"格式存盘，才能在FAT16的电脑中打开，在Windows 95 OSR2、Windows 98中提供了FAT16向FAT32之间的单向转换功能。
这种格式采用32位的文件分配表，使其对磁盘的管理能力大大增强，突破了fat16对每一个分区的容量只有2gb的限制，运用fat32的分区格式后，用户可以将一个大硬盘定义成一个分区，而不必分为几个分区使用，大大方便了对硬盘的管理工作。而且，fat32还具有一个最大的优点是：在一个不超过8gb的分区中，fat32分区格式的每个簇容量都固定为4kb，与fat16相比，可以大大地减少硬盘空间的浪费，提高了硬盘利用效率。
目前，支持这一磁盘分区格式的操作系统有win 97、win 98和win 2000/XP。但是，这种分区格式也有它的缺点，首先是采用fat32格式分区的磁盘，由于文件分配表的扩大，运行速度比采用fat16格式分区的硬盘要慢；另外，由于dos系统和某些早期的应用软件不支持这种分区格式，所以采用这种分区格式后，就无法再使用老的dos操作系统和某些旧的应用软件了。
3、ntfs

NTFS即是Windows NT的文件系统，它的最大优点是安全性和稳定性好，全32位内核的NTFS为磁盘目录与文件提供安全设置，指定访问权限，难以受到病毒侵袭。NTFS自动记录与文件的变动操作，具有文件修复能力，不需要运行磁盘碎片整理等磁盘工具。系统不易崩溃，出现错误能迅速修复。每簇仅为512个字节，硬盘利用率最高。它主要缺点正由于其高筑壁垒，闭关自守，从而导致兼容性差。Windows NT的NTFS可以访问FAT文件系统，但是逆向造访就会吃闭门羹，如在DOS下系统会显示"Invalid drive specification"（无效驱动器指派）。在Windows NT 4.0中提供了FAT向NTFS的单向转换功能；在最新的，具有NT内核的Windows 2000中，提供了FAT转换为NTFS或FAFAT32的功能。这些转换在进行之前应慎重考虑。
ntfs分区格式是一般电脑用户感到陌生的，它是网络操作系统windows nt的硬盘分区格式，使用windows nt的用户必须同这种分区格式打交道。其显著的优点是安全性和稳定性极其出色，在使用中不易产生文件碎片，对硬盘的空间利用及软件的运行速度都有好处。它能对用户的操作进行记录，通过对用户权限进行非常严格的限制，使每个用户只能按照系统赋予的权限进行操作，充分保护了网络系统与数据的安全。但是，目前支持这种分区格式的操作系统不多，除了windows nt外，win 2000 winxp win2003也支持这种硬盘分区格式。
**linux文件系统分类：**ext2：早期linux中常用的文件系统ext3：ext2的升级版，带日志功能ext4：ext3的升级版，大幅度改动RAMFS：内存文件系统，速度很快NFS：网络文件系统，由SUN发明，主要用于远程文件共享MS-DOS：MS-DOS文件系统VFAT：Windows95/98[操作系统](https://link.jianshu.com/?t=http://lib.csdn.net/base/operatingsystem)采用的文件系统FAT：WindowsXP操作系统采用的文件系统NTFS：WindowsNT/XP操作系统采用的文件系统HPFS：OS/2操作系统采用的文件系统PROC:虚拟的进程文件系统ISO9660：大部分光盘所采用的文件系统ufsSun:OS所采用的文件系统NCPFS：Novell服务器所采用的文件系统SMBFS：Samba的共享文件系统XFS：由SGI开发的先进的日志文件系统，支持超大容量文件JFS：IBM的AIX使用的日志文件系统ReiserFS:基于平衡树结构的文件系统udf:可擦写的数据光盘文件系统
4、虚拟文件系统VFS**linux支持的所有文件系统称为逻辑文件系统，而linux在传统的逻辑文件系统的基础上增加料一个蓄念文件系统(VitualFileSystem,VFS)的接口层。虚拟文件系统(VFS)位于文件系统的最上层，管理各种逻辑文件系统，并可以屏蔽各种逻辑文件系统之间的差异，提供统一文件和设备的访问接口。
**5、文件的逻辑结构**文件的逻辑结构可分为两大类：字节流式的无结构文件和记录式的有结构文件。由字节流（字节序列）组成的文件是一种无结构文件或流式文件，不考虑文件内部的逻辑结构，只是简单地看作是一系列字节的序列，便于在文件的任意位置添加内容。由记录组成的文件称为记录式文件，记录是这种文件类型的基本信息单位，记录式文件通用于信息管理。
**6、文件类型**普通文件：通常是流式文件目录文件：用于表示和管理系统中的全部文件连接文件：用于不同目录下文件的共享设备文件：包括块设备文件和字符设备文件，块设备文件表示磁盘文件、光盘等，字符设备文件按照字符操作终端、键盘等设备。管道(FIFO)文件:提供进程建通信的一种方式套接字(socket)文件：该文件类型与网络通信有关
**7、文件结构：**包括索引节点和数据索引节点：又称I节点，在文件系统结构中，包含有关相应文件的信息的一个记录，这些信息包括文件权限、文件名、文件大小、存放位置、建立日期等。文件系统中所有文件的索引节点保存在索引节点表中。数据：文件的实际内容。可以是空的，也可以非常大，并且拥有自己的结构。
**8、ext2文件系统**ext2文件系统的数据块大小一般为1024B、2048B或4096Bext2文件系统采用的索引节点(inode)：索引节点采用了多重索引结构，主要体现在直接指针和3个间接指针。直接指针包含12个直接指针块，它们直接指向包含文件数据的数据块，紧接在后面的3个间接指针是为了适应文件的大小变化而设计的。

网络模型：
OSI七层模型
应用层
表示层
会话层
传输层
网络层
数据链路层
物理层

TCP/IP四层模型
应用层
传输层
IP层
网络接口层